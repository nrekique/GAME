[gd_scene load_steps=11 format=3 uid="uid://dgpjxoygnvyy4"]

[ext_resource type="Script" path="res://assets/simple_fpsplayer/Player.gd" id="1_1fhis"]
[ext_resource type="Script" path="res://assets/simple_fpsplayer/ability_grab.gd" id="2_gwqkd"]
[ext_resource type="Shader" path="res://shaders/StencilShader.gdshader" id="3_qiyth"]
[ext_resource type="Script" path="res://Scripts/StencilCamera.gd" id="4_48wau"]
[ext_resource type="Script" path="res://Scripts/PortalCamera.gd" id="5_veebk"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_euj4i"]

[sub_resource type="ViewportTexture" id="ViewportTexture_fscxd"]
viewport_path = NodePath("Player/StencilViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_jfgod"]
resource_local_to_scene = true
shader = ExtResource("3_qiyth")
shader_parameter/stencil_tex = SubResource("ViewportTexture_fscxd")

[sub_resource type="ViewportTexture" id="ViewportTexture_pe2dp"]
viewport_path = NodePath("Player/PortalViewport")

[sub_resource type="Environment" id="Environment_ko30l"]
background_mode = 1
background_energy_multiplier = 0.0

[node name="Player" type="CharacterBody3D"]
disable_mode = 2
floor_max_angle = 0.802851
script = ExtResource("1_1fhis")

[node name="body" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_euj4i")

[node name="rotation_helper" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="Camera3D" type="Camera3D" parent="rotation_helper"]
cull_mask = 1048559

[node name="flashlight_player" type="SpotLight3D" parent="rotation_helper/Camera3D"]
visible = false
light_energy = 3.0
light_bake_mode = 0
spot_range = 10.0
spot_angle = 15.0
spot_angle_attenuation = 1.56917

[node name="ability_grab" type="RayCast3D" parent="rotation_helper/Camera3D"]
target_position = Vector3(0, 0, -2)
script = ExtResource("2_gwqkd")

[node name="GrabPosition3D" type="Marker3D" parent="rotation_helper/Camera3D/ability_grab"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -2)

[node name="TextureRect" type="TextureRect" parent="."]
material = SubResource("ShaderMaterial_jfgod")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("ViewportTexture_pe2dp")
metadata/_edit_use_anchors_ = true

[node name="StencilViewport" type="SubViewport" parent="."]
size = Vector2i(960, 720)
render_target_update_mode = 4

[node name="StencilCamera" type="Camera3D" parent="StencilViewport"]
cull_mask = 16
environment = SubResource("Environment_ko30l")
script = ExtResource("4_48wau")
main_cam_path = NodePath("../../rotation_helper/Camera3D")

[node name="PortalViewport2" type="SubViewport" parent="."]
size = Vector2i(960, 720)
render_target_update_mode = 4

[node name="PortalCamera" type="Camera3D" parent="PortalViewport2"]
cull_mask = 1048559
script = ExtResource("5_veebk")
